import{d as P,r as g,o as T,l as I,a as r,w as E,_ as F,H,b as e,c as d,e as c,t as a,m as v,v as U,p as b,F as B,i as L,k as m,j as N}from"./index-CBjmJUc4.js";const S={class:"space-y-6"},A={class:"grid grid-cols-2 md:grid-cols-4 gap-4"},O={class:"bg-white rounded-lg shadow-sm border border-gray-200 p-4"},G={class:"flex items-center gap-3"},q={class:"text-xl font-bold text-gray-900"},J={class:"bg-white rounded-lg shadow-sm border border-gray-200 p-4"},K={class:"flex items-center gap-3"},Q={class:"text-xl font-bold text-gray-900"},R={class:"bg-white rounded-lg shadow-sm border border-gray-200 p-4"},W={class:"flex items-center gap-3"},X={class:"text-xl font-bold text-gray-900"},Y={class:"bg-white rounded-lg shadow-sm border border-gray-200 p-4"},Z={class:"flex items-center gap-3"},ee={class:"text-xl font-bold text-gray-900"},te={class:"bg-white rounded-lg shadow-sm border border-gray-200 p-4"},se={class:"flex flex-col sm:flex-row sm:items-center gap-4"},oe={class:"flex flex-wrap gap-3 flex-1"},le={class:"bg-white rounded-lg shadow-sm border border-gray-200"},re={class:"px-4 py-3 border-b border-gray-200"},ae={class:"flex items-center justify-between"},ne={class:"text-sm text-gray-500"},de={key:0,class:"p-8 text-center"},ie={key:1,class:"space-y-2 p-4"},ue={class:"flex items-center gap-4"},ge={class:"flex-shrink-0"},ce={class:"flex-1 min-w-0"},ve={class:"flex items-center gap-3 mb-1"},pe={class:"text-gray-500 text-sm"},xe={class:"text-gray-500 text-sm"},fe=["title"],be={class:"flex items-center gap-2 flex-shrink-0"},me={key:0,class:"flex gap-1"},ye=["onClick"],he=["src","alt"],_e={key:0,class:"w-10 h-10 bg-gray-100 rounded border border-gray-300 flex items-center justify-center text-gray-500 text-xs"},we={key:1,class:"w-4 h-4 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},ke=["onClick"],Ce=["src"],je={key:3,class:"w-12 h-12 bg-red-50 rounded border border-red-200 flex items-center justify-center"},Me={key:2,class:"p-8 text-center text-gray-500"},De={key:3,class:"p-6 border-t border-gray-200"},Be={class:"flex items-center justify-between"},Le={class:"text-sm text-gray-500"},Ve={class:"flex gap-2"},$e=["disabled"],ze=["disabled"],Pe={class:"flex items-center justify-between mb-4"},Te={class:"text-lg font-semibold"},Ie=["src"],Ue=P({__name:"Generations",setup(Ee){const y=g(!1),h=g([]),p=g({total_generations:0,successful_generations:0,failed_generations:0,total_consumed_times:0}),l=g({page:1,limit:20,total:0,totalPages:0}),n=g({status:"",username:"",email:"",startDate:"",endDate:"",prompt:""}),x=g({show:!1,url:"",title:""});let _=null;const w=async()=>{try{y.value=!0;const o={};Object.entries(n.value).forEach(([s,i])=>{i&&i.trim()&&(o[s]=i.trim())});const t=await H.getAllHistory(l.value.page,l.value.limit,Object.keys(o).length>0?o:void 0);h.value=t.items,l.value=t.pagination,p.value=t.stats}catch(o){console.error("获取历史记录失败:",o),alert(o instanceof Error?o.message:"获取历史记录失败")}finally{y.value=!1}},f=()=>{l.value.page=1,w()},k=()=>{_&&clearTimeout(_),_=setTimeout(()=>{f()},500)},V=()=>{n.value={status:"",username:"",email:"",startDate:"",endDate:"",prompt:""},f()},C=o=>{o>=1&&o<=l.value.totalPages&&(l.value.page=o,w())},$=o=>({pending:"等待中",processing:"处理中",completed:"已完成",failed:"生成失败"})[o]||o,z=o=>{if(!o)return"";try{const t=new Date(o),i=new Date().getTime()-t.getTime(),u=Math.floor(i/(1e3*60*60*24));return u===0?"今天":u===1?"昨天":u<30?`${u}天前`:t.toLocaleDateString("zh-CN",{month:"2-digit",day:"2-digit"})}catch{return o}},j=o=>{const t=o.target;t.style.display="none"},M=(o,t)=>{x.value={show:!0,url:o,title:t}},D=()=>{x.value={show:!1,url:"",title:""}};return T(()=>{w()}),(o,t)=>(r(),I(F,null,{default:E(()=>[e("div",S,[t[25]||(t[25]=e("div",{class:"flex items-center justify-between"},[e("h1",{class:"text-2xl font-bold text-gray-800"},"生成记录"),e("div",{class:"text-sm text-gray-500"}," 查看所有用户的图片生成记录 ")],-1)),e("div",A,[e("div",O,[e("div",G,[t[10]||(t[10]=e("div",{class:"w-10 h-10 bg-purple-500 rounded-lg flex items-center justify-center text-white"},[e("svg",{class:"w-5 h-5",fill:"currentColor",viewBox:"0 0 20 20"},[e("path",{"fill-rule":"evenodd",d:"M4 3a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V5a2 2 0 00-2-2H4zm12 12H4l4-8 3 6 2-4 3 6z","clip-rule":"evenodd"})])],-1)),e("div",null,[e("div",q,a(p.value.total_generations),1),t[9]||(t[9]=e("div",{class:"text-gray-600 text-xs"},"总生成次数",-1))])])]),e("div",J,[e("div",K,[t[12]||(t[12]=e("div",{class:"w-10 h-10 bg-green-500 rounded-lg flex items-center justify-center text-white"},[e("svg",{class:"w-5 h-5",fill:"currentColor",viewBox:"0 0 20 20"},[e("path",{"fill-rule":"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z","clip-rule":"evenodd"})])],-1)),e("div",null,[e("div",Q,a(p.value.successful_generations),1),t[11]||(t[11]=e("div",{class:"text-gray-600 text-xs"},"成功生成",-1))])])]),e("div",R,[e("div",W,[t[14]||(t[14]=e("div",{class:"w-10 h-10 bg-red-500 rounded-lg flex items-center justify-center text-white"},[e("svg",{class:"w-5 h-5",fill:"currentColor",viewBox:"0 0 20 20"},[e("path",{"fill-rule":"evenodd",d:"M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z","clip-rule":"evenodd"})])],-1)),e("div",null,[e("div",X,a(p.value.failed_generations),1),t[13]||(t[13]=e("div",{class:"text-gray-600 text-xs"},"失败次数",-1))])])]),e("div",Y,[e("div",Z,[t[16]||(t[16]=e("div",{class:"w-10 h-10 bg-blue-500 rounded-lg flex items-center justify-center text-white"},[e("svg",{class:"w-5 h-5",fill:"currentColor",viewBox:"0 0 20 20"},[e("path",{d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})])],-1)),e("div",null,[e("div",ee,a(p.value.total_consumed_times),1),t[15]||(t[15]=e("div",{class:"text-gray-600 text-xs"},"消耗次数",-1))])])])]),e("div",te,[e("div",se,[t[18]||(t[18]=e("h3",{class:"text-sm font-medium text-gray-700"},"筛选：",-1)),e("div",oe,[v(e("select",{"onUpdate:modelValue":t[0]||(t[0]=s=>n.value.status=s),onChange:f,class:"px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm"},[...t[17]||(t[17]=[e("option",{value:""},"全部状态",-1),e("option",{value:"completed"},"已完成",-1),e("option",{value:"failed"},"生成失败",-1),e("option",{value:"processing"},"处理中",-1),e("option",{value:"pending"},"等待中",-1)])],544),[[U,n.value.status]]),v(e("input",{"onUpdate:modelValue":t[1]||(t[1]=s=>n.value.username=s),onInput:k,type:"text",placeholder:"用户名",class:"px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm w-32"},null,544),[[b,n.value.username]]),v(e("input",{"onUpdate:modelValue":t[2]||(t[2]=s=>n.value.email=s),onInput:k,type:"text",placeholder:"邮箱",class:"px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm w-40"},null,544),[[b,n.value.email]]),v(e("input",{"onUpdate:modelValue":t[3]||(t[3]=s=>n.value.startDate=s),onChange:f,type:"date",class:"px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm"},null,544),[[b,n.value.startDate]]),v(e("input",{"onUpdate:modelValue":t[4]||(t[4]=s=>n.value.endDate=s),onChange:f,type:"date",class:"px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm"},null,544),[[b,n.value.endDate]]),v(e("input",{"onUpdate:modelValue":t[5]||(t[5]=s=>n.value.prompt=s),onInput:k,type:"text",placeholder:"提示词",class:"px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm w-40"},null,544),[[b,n.value.prompt]])]),e("button",{onClick:V,class:"px-3 py-2 text-sm text-gray-600 hover:text-gray-800 border border-gray-300 rounded-md hover:bg-gray-50 transition-colors"}," 清除 ")])]),e("div",le,[e("div",re,[e("div",ae,[t[19]||(t[19]=e("h3",{class:"text-lg font-semibold text-gray-900"},"生成记录",-1)),e("div",ne," 共 "+a(l.value.total)+" 条记录 ",1)])]),y.value?(r(),d("div",de,[...t[20]||(t[20]=[e("div",{class:"text-4xl mb-4"},"⏳",-1),e("p",{class:"text-gray-500"},"加载中...",-1)])])):h.value.length>0?(r(),d("div",ie,[(r(!0),d(B,null,L(h.value,s=>(r(),d("div",{key:s.id,class:"border border-gray-200 rounded-lg p-4 hover:border-blue-300 hover:bg-blue-50/30 transition-all"},[e("div",ue,[e("div",ge,[e("div",{class:m([{"bg-green-500":s.status==="completed","bg-red-500":s.status==="failed","bg-yellow-500":s.status==="processing","bg-gray-400":s.status==="pending"},"w-3 h-3 rounded-full"])},null,2)]),e("div",ce,[e("div",ve,[e("span",{class:m([{"bg-green-100 text-green-700":s.status==="completed","bg-red-100 text-red-700":s.status==="failed","bg-yellow-100 text-yellow-700":s.status==="processing","bg-gray-100 text-gray-700":s.status==="pending"},"px-2 py-1 rounded-md text-xs font-medium"])},a($(s.status)),3),e("span",pe,a(z(s.created_at)),1),e("span",{class:m([{"text-blue-600":s.status==="completed"&&s.consumed_times>0,"text-gray-500":s.status==="failed"||s.consumed_times===0},"text-sm font-medium"])},a(s.status==="failed"?"未消耗":s.consumed_times>0?`消耗${s.consumed_times}次`:"未消耗"),3),e("span",xe,a(s.username||"未知用户")+" ("+a(s.email||"未知邮箱")+") ",1)]),e("p",{class:"text-gray-700 text-sm truncate",title:s.prompt},a(s.prompt),9,fe)]),e("div",be,[s.original_images&&s.original_images.length>0?(r(),d("div",me,[(r(!0),d(B,null,L(s.original_images.slice(0,2),(i,u)=>(r(),d("button",{key:u,onClick:Fe=>M(i,`参考图片 ${u+1}`),class:"w-10 h-10 bg-gray-100 rounded border border-gray-300 hover:border-blue-400 transition-colors overflow-hidden"},[e("img",{src:i,alt:`参考图片 ${u+1}`,class:"w-full h-full object-cover",onError:j},null,40,he)],8,ye))),128)),s.original_images.length>2?(r(),d("div",_e," +"+a(s.original_images.length-2),1)):c("",!0)])):c("",!0),s.original_images&&s.original_images.length>0&&s.generated_image?(r(),d("svg",we,[...t[21]||(t[21]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 5l7 7-7 7"},null,-1)])])):c("",!0),s.generated_image?(r(),d("button",{key:2,onClick:i=>M(s.generated_image,"生成结果"),class:"w-12 h-12 bg-gray-100 rounded border-2 border-blue-300 hover:border-blue-500 transition-colors overflow-hidden"},[e("img",{src:s.generated_image,alt:"生成结果",class:"w-full h-full object-cover",onError:j},null,40,Ce)],8,ke)):s.status==="failed"?(r(),d("div",je,[...t[22]||(t[22]=[e("svg",{class:"w-5 h-5 text-red-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])])):c("",!0)])])]))),128))])):(r(),d("div",Me,[...t[23]||(t[23]=[e("div",{class:"text-4xl mb-4"},"📝",-1),e("p",{class:"text-lg mb-2"},"暂无生成记录",-1),e("p",{class:"text-sm"},"当前筛选条件下没有找到记录",-1)])])),l.value.totalPages>1?(r(),d("div",De,[e("div",Be,[e("div",Le," 第 "+a(l.value.page)+" 页，共 "+a(l.value.totalPages)+" 页 ",1),e("div",Ve,[e("button",{onClick:t[6]||(t[6]=s=>C(l.value.page-1)),disabled:l.value.page<=1,class:m([l.value.page<=1?"opacity-50 cursor-not-allowed":"hover:bg-gray-100","px-3 py-1 text-sm border border-gray-300 rounded"])}," 上一页 ",10,$e),e("button",{onClick:t[7]||(t[7]=s=>C(l.value.page+1)),disabled:l.value.page>=l.value.totalPages,class:m([l.value.page>=l.value.totalPages?"opacity-50 cursor-not-allowed":"hover:bg-gray-100","px-3 py-1 text-sm border border-gray-300 rounded"])}," 下一页 ",10,ze)])])])):c("",!0)]),x.value.show?(r(),d("div",{key:0,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",onClick:D},[e("div",{class:"bg-white rounded-lg p-6 max-w-4xl max-h-[90vh] overflow-auto",onClick:t[8]||(t[8]=N(()=>{},["stop"]))},[e("div",Pe,[e("h3",Te,a(x.value.title),1),e("button",{onClick:D,class:"text-gray-400 hover:text-gray-600"},[...t[24]||(t[24]=[e("span",{class:"text-2xl"},"×",-1)])])]),e("img",{src:x.value.url,alt:"预览图片",class:"max-w-full max-h-[70vh] object-contain mx-auto"},null,8,Ie)])])):c("",!0)])]),_:1}))}});export{Ue as default};
