import{d as A,r as n,s as V,o as E,l as I,a as i,w as L,_ as O,A as b,b as e,c as u,e as k,h as Q,m as d,p,v as M,i as G,t as l,k as U,F as H,j}from"./index-CBjmJUc4.js";const J={class:"space-y-6"},K={class:"flex justify-between items-center"},R={class:"bg-white p-4 rounded-lg shadow-sm border"},W={class:"flex gap-4"},X={class:"flex-1"},Y={class:"bg-white rounded-lg shadow-sm border"},Z={class:"overflow-x-auto"},ee={class:"w-full"},te={class:"bg-white divide-y divide-gray-200"},se={key:0,class:"text-center"},ae={key:1,class:"text-center"},re={class:"px-6 py-4"},oe={class:"text-sm font-medium text-gray-900"},le={class:"text-sm text-gray-500"},ne={class:"px-6 py-4"},ie={class:"text-sm text-gray-900"},de={class:"text-sm text-gray-500"},ue={class:"px-6 py-4"},ce={class:"text-sm font-medium text-gray-900"},pe={class:"px-6 py-4"},xe={class:"px-6 py-4 text-sm text-gray-900"},me={class:"px-6 py-4 text-sm text-gray-500"},be={class:"px-6 py-4 text-right text-sm font-medium space-x-2"},ye=["onClick"],ge=["onClick"],ve=["onClick"],fe={key:0,class:"px-6 py-3 border-t border-gray-200"},_e={class:"flex items-center justify-between"},we={class:"text-sm text-gray-700"},he={class:"flex space-x-2"},ke=["disabled"],Ce=["disabled"],Pe={class:"bg-white rounded-lg p-6 w-full max-w-md mx-4"},$e={class:"text-lg font-semibold mb-4"},Ve={key:0},Me={class:"flex justify-end space-x-3 pt-4"},Ue=["disabled"],Se=A({__name:"Packages",setup(je){const _=n([]),w=n(!1),y=n(""),C=n(""),x=n(!1),m=n(!1),g=n(!1),v=n(null),o=V({page:1,limit:10,total:0,totalPages:0}),r=V({name:"",usage_count:1,validity_days:30,price:0,sort_order:0,is_active:!0}),D=()=>{r.name="",r.usage_count=1,r.validity_days=30,r.price=0,r.sort_order=0,r.is_active=!0},c=async()=>{w.value=!0;try{const a={page:o.page,limit:o.limit,sortBy:"sort_order",sortOrder:"asc"};y.value&&(a.search=y.value);const t=await b.getPackages(a);_.value=t.items,Object.assign(o,t.pagination)}catch(a){console.error("加载套餐列表失败:",a),alert("加载套餐列表失败")}finally{w.value=!1}};let P;const S=()=>{clearTimeout(P),P=setTimeout(()=>{o.page=1,c()},500)},$=a=>{o.page=a,c()},F=a=>{v.value=a,r.name=a.name,r.usage_count=a.usage_count,r.validity_days=a.validity_days,r.price=a.price,r.sort_order=a.sort_order,r.is_active=a.is_active,m.value=!0},q=async a=>{const t=!a.is_active,s=t?"启用":"禁用";if(confirm(`确定要${s}套餐"${a.name}"吗？`))try{await b.updatePackage(a.id,{is_active:t}),a.is_active=t,alert(`套餐${s}成功`)}catch(f){console.error(`${s}套餐失败:`,f),alert(`${s}套餐失败`)}},B=async a=>{if(confirm(`确定要删除套餐"${a.name}"吗？此操作不可恢复。`))try{await b.deletePackage(a.id),alert("套餐删除成功"),c()}catch(t){console.error("删除套餐失败:",t),alert("删除套餐失败")}},T=()=>!r.price||r.price<=0?(alert("套餐价格必须大于0元"),!1):!0,N=async()=>{if(T()){g.value=!0;try{if(x.value){const{is_active:a,...t}=r;await b.createPackage(t),alert("套餐创建成功")}else if(m.value&&v.value){const a={...r};await b.updatePackage(v.value.id,a),alert("套餐更新成功")}h(),c()}catch(a){console.error("保存套餐失败:",a);const t=a instanceof Error?a.message:"保存套餐失败";alert(t)}finally{g.value=!1}}},h=()=>{x.value=!1,m.value=!1,v.value=null,D()},z=a=>new Date(a).toLocaleString("zh-CN");return E(()=>{c()}),(a,t)=>(i(),I(O,null,{default:L(()=>[e("div",J,[e("div",K,[t[12]||(t[12]=e("div",null,[e("h1",{class:"text-2xl font-bold text-gray-900"},"套餐管理"),e("p",{class:"text-gray-600"},"管理系统套餐配置")],-1)),e("button",{onClick:t[0]||(t[0]=s=>x.value=!0),class:"bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors"},[...t[11]||(t[11]=[e("i",{class:"fas fa-plus mr-2"},null,-1),Q(" 新增套餐 ",-1)])])]),e("div",R,[e("div",W,[e("div",X,[d(e("input",{"onUpdate:modelValue":t[1]||(t[1]=s=>y.value=s),type:"text",placeholder:"搜索套餐名称...",class:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",onInput:S},null,544),[[p,y.value]])]),d(e("select",{"onUpdate:modelValue":t[2]||(t[2]=s=>C.value=s),onChange:c,class:"px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"},[...t[13]||(t[13]=[e("option",{value:""},"全部状态",-1),e("option",{value:"active"},"启用",-1),e("option",{value:"inactive"},"禁用",-1)])],544),[[M,C.value]])])]),e("div",Y,[e("div",Z,[e("table",ee,[t[16]||(t[16]=e("thead",{class:"bg-gray-50"},[e("tr",null,[e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," 套餐信息 "),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," 次数/有效期 "),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," 价格 "),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," 状态 "),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," 排序 "),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," 创建时间 "),e("th",{class:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider"}," 操作 ")])],-1)),e("tbody",te,[w.value?(i(),u("tr",se,[...t[14]||(t[14]=[e("td",{colspan:"7",class:"px-6 py-12"},[e("div",{class:"flex justify-center"},[e("div",{class:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})])],-1)])])):_.value.length===0?(i(),u("tr",ae,[...t[15]||(t[15]=[e("td",{colspan:"7",class:"px-6 py-12 text-gray-500"}," 暂无套餐数据 ",-1)])])):(i(!0),u(H,{key:2},G(_.value,s=>(i(),u("tr",{key:s.id,class:"hover:bg-gray-50"},[e("td",re,[e("div",null,[e("div",oe,l(s.name),1),e("div",le,"ID: "+l(s.id),1)])]),e("td",ne,[e("div",ie,l(s.usage_count)+" 次",1),e("div",de,l(s.validity_days)+" 天",1)]),e("td",ue,[e("div",ce,"¥"+l(s.price),1)]),e("td",pe,[e("span",{class:U([{"bg-green-100 text-green-800":s.is_active,"bg-red-100 text-red-800":!s.is_active},"inline-flex px-2 py-1 text-xs font-semibold rounded-full"])},l(s.is_active?"启用":"禁用"),3)]),e("td",xe,l(s.sort_order),1),e("td",me,l(z(s.created_at)),1),e("td",be,[e("button",{onClick:f=>F(s),class:"text-blue-600 hover:text-blue-900"}," 编辑 ",8,ye),e("button",{onClick:f=>q(s),class:U({"text-red-600 hover:text-red-900":s.is_active,"text-green-600 hover:text-green-900":!s.is_active})},l(s.is_active?"禁用":"启用"),11,ge),e("button",{onClick:f=>B(s),class:"text-red-600 hover:text-red-900"}," 删除 ",8,ve)])]))),128))])])]),o.totalPages>1?(i(),u("div",fe,[e("div",_e,[e("div",we," 共 "+l(o.total)+" 条记录，第 "+l(o.page)+" / "+l(o.totalPages)+" 页 ",1),e("div",he,[e("button",{onClick:t[3]||(t[3]=s=>$(o.page-1)),disabled:o.page<=1,class:"px-3 py-1 text-sm border rounded disabled:opacity-50 disabled:cursor-not-allowed"}," 上一页 ",8,ke),e("button",{onClick:t[4]||(t[4]=s=>$(o.page+1)),disabled:o.page>=o.totalPages,class:"px-3 py-1 text-sm border rounded disabled:opacity-50 disabled:cursor-not-allowed"}," 下一页 ",8,Ce)])])])):k("",!0)])]),x.value||m.value?(i(),u("div",{key:0,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",onClick:j(h,["self"])},[e("div",Pe,[e("h3",$e,l(x.value?"新增套餐":"编辑套餐"),1),e("form",{onSubmit:j(N,["prevent"]),class:"space-y-4"},[e("div",null,[t[17]||(t[17]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"套餐名称",-1)),d(e("input",{"onUpdate:modelValue":t[5]||(t[5]=s=>r.name=s),type:"text",required:"",class:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"请输入套餐名称"},null,512),[[p,r.name]])]),e("div",null,[t[18]||(t[18]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"使用次数",-1)),d(e("input",{"onUpdate:modelValue":t[6]||(t[6]=s=>r.usage_count=s),type:"number",min:"1",max:"10000",required:"",class:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"请输入使用次数"},null,512),[[p,r.usage_count,void 0,{number:!0}]])]),e("div",null,[t[19]||(t[19]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"有效期（天）",-1)),d(e("input",{"onUpdate:modelValue":t[7]||(t[7]=s=>r.validity_days=s),type:"number",min:"1",max:"3650",required:"",class:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"请输入有效期天数"},null,512),[[p,r.validity_days,void 0,{number:!0}]])]),e("div",null,[t[20]||(t[20]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"价格（元）",-1)),d(e("input",{"onUpdate:modelValue":t[8]||(t[8]=s=>r.price=s),type:"number",min:"0.01",max:"99999.99",step:"0.01",required:"",class:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"请输入价格"},null,512),[[p,r.price,void 0,{number:!0}]])]),e("div",null,[t[21]||(t[21]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"排序",-1)),d(e("input",{"onUpdate:modelValue":t[9]||(t[9]=s=>r.sort_order=s),type:"number",min:"0",max:"9999",class:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"排序数字，越小越靠前"},null,512),[[p,r.sort_order,void 0,{number:!0}]])]),m.value?(i(),u("div",Ve,[t[23]||(t[23]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"状态",-1)),d(e("select",{"onUpdate:modelValue":t[10]||(t[10]=s=>r.is_active=s),class:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"},[...t[22]||(t[22]=[e("option",{value:!0},"启用",-1),e("option",{value:!1},"禁用",-1)])],512),[[M,r.is_active]])])):k("",!0),e("div",Me,[e("button",{type:"button",onClick:h,class:"px-4 py-2 text-gray-600 border border-gray-300 rounded-lg hover:bg-gray-50"}," 取消 "),e("button",{type:"submit",disabled:g.value,class:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50"},l(g.value?"保存中...":"保存"),9,Ue)])],32)])])):k("",!0)]),_:1}))}});export{Se as default};
