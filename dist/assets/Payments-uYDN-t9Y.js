import{q as E,d as G,r as v,o as H,l as J,a as i,w as K,_ as Q,b as e,c as p,e as b,h as k,t as n,m as f,p as h,v as F,F as W,i as X,k as U,j as Y}from"./index-CBjmJUc4.js";const x=E.create({baseURL:"/api",timeout:3e4,headers:{"Content-Type":"application/json"}});x.interceptors.request.use(l=>{const r=localStorage.getItem("token");return r&&(l.headers.Authorization=`Bearer ${r}`),l},l=>Promise.reject(l));x.interceptors.response.use(l=>l,l=>{var r;return((r=l.response)==null?void 0:r.status)===401&&(localStorage.removeItem("token"),localStorage.removeItem("user"),window.location.href="/login"),Promise.reject(l)});const S={async getStats(){return(await x.get("/recharge/admin/stats")).data},async getRecords(l){const r=new URLSearchParams(l).toString();return(await x.get(`/recharge/admin/records?${r}`)).data},async getRecordById(l){return(await x.get(`/recharge/admin/records/${l}`)).data},async updateRecordStatus(l,r,g){return(await x.patch(`/recharge/admin/records/${l}/status`,{status:r,transaction_id:g})).data},async exportRecords(l){const r=new URLSearchParams(l).toString();return await x.get(`/recharge/admin/export?${r}`,{responseType:"blob"})},async createRecord(l){return(await x.post("/recharge/create",l)).data},async getMyRecords(l){const r=new URLSearchParams(l).toString();return(await x.get(`/recharge/my-records?${r}`)).data}},Z={class:"space-y-6"},ee={class:"flex items-center justify-between"},te={class:"flex items-center gap-4"},se=["disabled"],ae={key:0,class:"animate-spin"},oe={key:1},ne=["disabled"],le={class:"grid grid-cols-1 md:grid-cols-4 gap-6"},re={class:"bg-white rounded-lg shadow-sm border border-gray-200 p-6"},de={class:"flex items-center gap-4"},ie={class:"text-2xl font-bold text-gray-900"},ue={class:"bg-white rounded-lg shadow-sm border border-gray-200 p-6"},pe={class:"flex items-center gap-4"},ce={class:"text-2xl font-bold text-gray-900"},ge={class:"bg-white rounded-lg shadow-sm border border-gray-200 p-6"},me={class:"flex items-center gap-4"},xe={class:"text-2xl font-bold text-gray-900"},ve={class:"bg-white rounded-lg shadow-sm border border-gray-200 p-6"},ye={class:"flex items-center gap-4"},be={class:"text-2xl font-bold text-gray-900"},fe={class:"bg-white rounded-lg shadow-sm border border-gray-200 p-6"},_e={class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4"},we={class:"flex gap-2"},he={class:"mt-4 grid grid-cols-1 md:grid-cols-2 gap-4"},ke={class:"bg-white rounded-lg shadow-sm border border-gray-200"},Se={class:"p-6 border-b border-gray-200 flex items-center justify-between"},Ce={class:"text-sm text-gray-500"},Re={key:0,class:"p-8 text-center"},je={key:1,class:"p-8 text-center text-gray-500"},Pe={key:2,class:"overflow-x-auto"},Ue={class:"w-full"},$e={class:"bg-gray-50"},Oe={key:0},Ie={key:0},Le={key:0},Te={class:"bg-white divide-y divide-gray-200"},Ve={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-900"},Be={class:"px-6 py-4 whitespace-nowrap"},Fe={class:"text-sm font-medium text-gray-900"},Me={class:"text-sm text-gray-500"},De={class:"px-6 py-4 whitespace-nowrap"},qe={class:"text-sm font-bold text-gray-900"},Ae={class:"px-6 py-4 whitespace-nowrap"},ze={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},Ne={class:"px-6 py-4 whitespace-nowrap"},Ee={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},Ge={class:"px-6 py-4 whitespace-nowrap text-sm font-medium"},He={class:"flex items-center gap-2"},Je=["onClick"],Ke=["onClick"],Qe=["onClick"],We={key:3,class:"px-6 py-4 border-t border-gray-200 flex items-center justify-between"},Xe={class:"text-sm text-gray-500"},Ye={class:"flex items-center gap-2"},Ze=["disabled"],et={class:"px-3 py-1 text-sm text-gray-700"},tt=["disabled"],st={class:"space-y-3"},at={class:"flex justify-between"},ot={class:"font-medium"},nt={class:"flex justify-between"},lt={class:"font-medium"},rt={class:"flex justify-between"},dt={class:"font-medium"},it={class:"flex justify-between"},ut={class:"font-bold text-green-600"},pt={class:"flex justify-between"},ct={class:"font-medium"},gt={class:"flex justify-between"},mt={class:"font-medium"},xt={class:"flex justify-between"},vt={class:"flex justify-between"},yt={class:"font-medium"},bt={class:"flex justify-between"},ft={class:"font-medium"},wt=G({__name:"Payments",setup(l){const r=v(!1),g=v([]),u=v(null),w=v({totalRevenue:0,todayRevenue:0,monthRevenue:0,totalOrders:0,todayOrders:0,monthOrders:0,pendingOrders:0,completedOrders:0,failedOrders:0,refundedOrders:0,avgOrderAmount:0}),d=v({page:1,limit:20,total:0,totalPages:0}),o=v({search:"",status:"",payment_method:"",start_date:"",end_date:"",min_amount:void 0,max_amount:void 0}),_=v("created_at"),y=v("desc");let $;const C=()=>{clearTimeout($),$=setTimeout(()=>{m()},500)},m=async()=>{try{r.value=!0;const s=new URLSearchParams({page:d.value.page.toString(),limit:d.value.limit.toString(),sortBy:_.value,sortOrder:y.value});o.value.search&&s.append("search",o.value.search),o.value.status&&s.append("status",o.value.status),o.value.payment_method&&s.append("payment_method",o.value.payment_method),o.value.start_date&&s.append("start_date",o.value.start_date),o.value.end_date&&s.append("end_date",o.value.end_date),o.value.min_amount!==void 0&&s.append("min_amount",o.value.min_amount.toString()),o.value.max_amount!==void 0&&s.append("max_amount",o.value.max_amount.toString());const t={};for(const[c,N]of s.entries())t[c]=N;const a=await S.getRecords(t);a.success?(g.value=a.data.records||[],d.value=a.data.pagination||{page:1,limit:20,total:0,totalPages:0}):console.error("API返回错误:",a.message)}catch(s){console.error("加载充值记录失败:",s),s.response&&console.error("错误响应:",s.response.data)}finally{r.value=!1}},M=async()=>{try{const s=await S.getStats();s.success?w.value=s.data:console.error("统计数据API返回错误:",s.message)}catch(s){console.error("加载统计数据失败:",s)}},R=async()=>{await Promise.all([m(),M()])},j=s=>{_.value===s?y.value=y.value==="desc"?"asc":"desc":(_.value=s,y.value="desc"),m()},O=s=>{d.value.page=s,m()},D=()=>{o.value={search:"",status:"",payment_method:"",start_date:"",end_date:"",min_amount:void 0,max_amount:void 0},d.value.page=1,m()},q=s=>{u.value=s},I=()=>{u.value=null},L=async(s,t)=>{try{(await S.updateRecordStatus(s,t)).success&&await R()}catch(a){console.error("更新状态失败:",a)}},A=async()=>{try{const s={};o.value.search&&(s.search=o.value.search),o.value.status&&(s.status=o.value.status),o.value.payment_method&&(s.payment_method=o.value.payment_method),o.value.start_date&&(s.start_date=o.value.start_date),o.value.end_date&&(s.end_date=o.value.end_date),o.value.min_amount!==void 0&&(s.min_amount=o.value.min_amount.toString()),o.value.max_amount!==void 0&&(s.max_amount=o.value.max_amount.toString());const t=await S.exportRecords(s),a=window.URL.createObjectURL(new Blob([t.data])),c=document.createElement("a");c.href=a,c.setAttribute("download",`充值记录_${new Date().toISOString().split("T")[0]}.csv`),document.body.appendChild(c),c.click(),document.body.removeChild(c),window.URL.revokeObjectURL(a)}catch(s){console.error("导出失败:",s)}},T=s=>({pending:"bg-yellow-100 text-yellow-800",completed:"bg-green-100 text-green-800",failed:"bg-red-100 text-red-800"})[s]||"bg-gray-100 text-gray-800",V=s=>({pending:"待处理",completed:"已完成",failed:"失败"})[s]||s,z=s=>({wechat:"bg-green-100 text-green-800",alipay:"bg-blue-100 text-blue-800",balance:"bg-purple-100 text-purple-800"})[s]||"bg-gray-100 text-gray-800",B=s=>({wechat:"微信支付",alipay:"支付宝",balance:"余额支付"})[s]||s,P=s=>new Date(s).toLocaleString("zh-CN");return H(()=>{R()}),(s,t)=>(i(),J(Q,null,{default:K(()=>[e("div",Z,[e("div",ee,[t[14]||(t[14]=e("h1",{class:"text-2xl font-bold text-gray-800"},"充值记录",-1)),e("div",te,[e("button",{onClick:R,disabled:r.value,class:"px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 disabled:opacity-50 flex items-center gap-2"},[r.value?(i(),p("span",ae,"⟳")):(i(),p("span",oe,"🔄")),t[13]||(t[13]=k(" 刷新数据 ",-1))],8,se),e("button",{onClick:A,disabled:r.value,class:"px-4 py-2 bg-green-500 text-white rounded-lg hover:bg-green-600 disabled:opacity-50 flex items-center gap-2"}," 📥 导出记录 ",8,ne)])]),e("div",le,[e("div",re,[e("div",de,[t[16]||(t[16]=e("div",{class:"w-12 h-12 bg-green-500 rounded-lg flex items-center justify-center text-white text-xl"}," 💰 ",-1)),e("div",null,[e("div",ie,"¥"+n(w.value.totalRevenue.toFixed(2)),1),t[15]||(t[15]=e("div",{class:"text-gray-600 text-sm"},"总收入",-1))])])]),e("div",ue,[e("div",pe,[t[18]||(t[18]=e("div",{class:"w-12 h-12 bg-blue-500 rounded-lg flex items-center justify-center text-white text-xl"}," 📊 ",-1)),e("div",null,[e("div",ce,"¥"+n(w.value.todayRevenue.toFixed(2)),1),t[17]||(t[17]=e("div",{class:"text-gray-600 text-sm"},"今日收入",-1))])])]),e("div",ge,[e("div",me,[t[20]||(t[20]=e("div",{class:"w-12 h-12 bg-purple-500 rounded-lg flex items-center justify-center text-white text-xl"}," 🔢 ",-1)),e("div",null,[e("div",xe,n(w.value.totalOrders),1),t[19]||(t[19]=e("div",{class:"text-gray-600 text-sm"},"总订单数",-1))])])]),e("div",ve,[e("div",ye,[t[22]||(t[22]=e("div",{class:"w-12 h-12 bg-orange-500 rounded-lg flex items-center justify-center text-white text-xl"}," ⏱️ ",-1)),e("div",null,[e("div",be,n(w.value.pendingOrders),1),t[21]||(t[21]=e("div",{class:"text-gray-600 text-sm"},"待处理订单",-1))])])])]),e("div",fe,[e("div",_e,[e("div",null,[t[23]||(t[23]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"搜索",-1)),f(e("input",{"onUpdate:modelValue":t[0]||(t[0]=a=>o.value.search=a),type:"text",placeholder:"用户名、邮箱或交易号",class:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",onInput:C},null,544),[[h,o.value.search]])]),e("div",null,[t[25]||(t[25]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"状态",-1)),f(e("select",{"onUpdate:modelValue":t[1]||(t[1]=a=>o.value.status=a),class:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",onChange:m},[...t[24]||(t[24]=[e("option",{value:""},"全部状态",-1),e("option",{value:"pending"},"待处理",-1),e("option",{value:"completed"},"已完成",-1),e("option",{value:"failed"},"失败",-1)])],544),[[F,o.value.status]])]),e("div",null,[t[27]||(t[27]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"支付方式",-1)),f(e("select",{"onUpdate:modelValue":t[2]||(t[2]=a=>o.value.payment_method=a),class:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",onChange:m},[...t[26]||(t[26]=[e("option",{value:""},"全部方式",-1),e("option",{value:"wechat"},"微信支付",-1),e("option",{value:"alipay"},"支付宝",-1),e("option",{value:"balance"},"余额支付",-1)])],544),[[F,o.value.payment_method]])]),e("div",null,[t[28]||(t[28]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"日期范围",-1)),e("div",we,[f(e("input",{"onUpdate:modelValue":t[3]||(t[3]=a=>o.value.start_date=a),type:"date",class:"flex-1 px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",onChange:m},null,544),[[h,o.value.start_date]]),f(e("input",{"onUpdate:modelValue":t[4]||(t[4]=a=>o.value.end_date=a),type:"date",class:"flex-1 px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",onChange:m},null,544),[[h,o.value.end_date]])])])]),e("div",he,[e("div",null,[t[29]||(t[29]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"最小金额",-1)),f(e("input",{"onUpdate:modelValue":t[5]||(t[5]=a=>o.value.min_amount=a),type:"number",min:"0",step:"0.01",placeholder:"0.00",class:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",onInput:C},null,544),[[h,o.value.min_amount,void 0,{number:!0}]])]),e("div",null,[t[30]||(t[30]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"最大金额",-1)),f(e("input",{"onUpdate:modelValue":t[6]||(t[6]=a=>o.value.max_amount=a),type:"number",min:"0",step:"0.01",placeholder:"无限制",class:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",onInput:C},null,544),[[h,o.value.max_amount,void 0,{number:!0}]])])]),e("div",{class:"mt-4 flex justify-end"},[e("button",{onClick:D,class:"px-4 py-2 text-gray-600 hover:text-gray-800 hover:bg-gray-100 rounded-lg"}," 清除筛选 ")])]),e("div",ke,[e("div",Se,[t[31]||(t[31]=e("h3",{class:"text-lg font-semibold text-gray-900"},"充值记录列表",-1)),e("div",Ce," 共 "+n(d.value.total)+" 条记录 ",1)]),r.value?(i(),p("div",Re,[...t[32]||(t[32]=[e("div",{class:"animate-spin text-4xl mb-4"},"⟳",-1),e("p",{class:"text-gray-500"},"加载中...",-1)])])):g.value.length===0?(i(),p("div",je,[...t[33]||(t[33]=[e("div",{class:"text-4xl mb-4"},"📝",-1),e("p",{class:"text-lg mb-2"},"暂无充值记录",-1),e("p",{class:"text-sm"},"没有找到符合条件的充值记录",-1)])])):(i(),p("div",Pe,[e("table",Ue,[e("thead",$e,[e("tr",null,[t[37]||(t[37]=e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," ID ",-1)),t[38]||(t[38]=e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," 用户信息 ",-1)),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer hover:bg-gray-100",onClick:t[7]||(t[7]=a=>j("amount"))},[t[34]||(t[34]=k(" 充值金额 ",-1)),_.value==="amount"?(i(),p("span",Oe,n(y.value==="desc"?"↓":"↑"),1)):b("",!0)]),t[39]||(t[39]=e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," 支付方式 ",-1)),t[40]||(t[40]=e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," 交易号 ",-1)),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer hover:bg-gray-100",onClick:t[8]||(t[8]=a=>j("status"))},[t[35]||(t[35]=k(" 状态 ",-1)),_.value==="status"?(i(),p("span",Ie,n(y.value==="desc"?"↓":"↑"),1)):b("",!0)]),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer hover:bg-gray-100",onClick:t[9]||(t[9]=a=>j("created_at"))},[t[36]||(t[36]=k(" 创建时间 ",-1)),_.value==="created_at"?(i(),p("span",Le,n(y.value==="desc"?"↓":"↑"),1)):b("",!0)]),t[41]||(t[41]=e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," 操作 ",-1))])]),e("tbody",Te,[(i(!0),p(W,null,X(g.value,a=>(i(),p("tr",{key:a.id,class:"hover:bg-gray-50"},[e("td",Ve," #"+n(a.id),1),e("td",Be,[e("div",Fe,n(a.username),1),e("div",Me,n(a.email),1)]),e("td",De,[e("div",qe,"¥"+n(parseFloat(a.amount).toFixed(2)),1)]),e("td",Ae,[e("span",{class:U(["inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium",z(a.payment_method)])},n(B(a.payment_method)),3)]),e("td",ze,n(a.transaction_id||"-"),1),e("td",Ne,[e("span",{class:U(["inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium",T(a.status)])},n(V(a.status)),3)]),e("td",Ee,n(P(a.created_at)),1),e("td",Ge,[e("div",He,[e("button",{onClick:c=>q(a),class:"text-blue-600 hover:text-blue-900"}," 查看 ",8,Je),a.status==="pending"?(i(),p("button",{key:0,onClick:c=>L(a.id,"completed"),class:"text-green-600 hover:text-green-900"}," 完成 ",8,Ke)):b("",!0),a.status==="pending"?(i(),p("button",{key:1,onClick:c=>L(a.id,"failed"),class:"text-red-600 hover:text-red-900"}," 失败 ",8,Qe)):b("",!0)])])]))),128))])])])),g.value.length>0?(i(),p("div",We,[e("div",Xe," 显示第 "+n((d.value.page-1)*d.value.limit+1)+" - "+n(Math.min(d.value.page*d.value.limit,d.value.total))+" 条， 共 "+n(d.value.total)+" 条记录 ",1),e("div",Ye,[e("button",{onClick:t[10]||(t[10]=a=>O(d.value.page-1)),disabled:d.value.page<=1,class:"px-3 py-1 border border-gray-300 rounded hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed"}," 上一页 ",8,Ze),e("span",et," 第 "+n(d.value.page)+" / "+n(d.value.totalPages)+" 页 ",1),e("button",{onClick:t[11]||(t[11]=a=>O(d.value.page+1)),disabled:d.value.page>=d.value.totalPages,class:"px-3 py-1 border border-gray-300 rounded hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed"}," 下一页 ",8,tt)])])):b("",!0)])]),u.value?(i(),p("div",{key:0,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",onClick:I},[e("div",{class:"bg-white rounded-lg p-6 max-w-md w-full mx-4",onClick:t[12]||(t[12]=Y(()=>{},["stop"]))},[e("div",{class:"flex items-center justify-between mb-4"},[t[42]||(t[42]=e("h3",{class:"text-lg font-semibold"},"充值记录详情",-1)),e("button",{onClick:I,class:"text-gray-400 hover:text-gray-600"}," ✕ ")]),e("div",st,[e("div",at,[t[43]||(t[43]=e("span",{class:"text-gray-600"},"记录ID:",-1)),e("span",ot,"#"+n(u.value.id),1)]),e("div",nt,[t[44]||(t[44]=e("span",{class:"text-gray-600"},"用户:",-1)),e("span",lt,n(u.value.username),1)]),e("div",rt,[t[45]||(t[45]=e("span",{class:"text-gray-600"},"邮箱:",-1)),e("span",dt,n(u.value.email),1)]),e("div",it,[t[46]||(t[46]=e("span",{class:"text-gray-600"},"充值金额:",-1)),e("span",ut,"¥"+n(parseFloat(u.value.amount).toFixed(2)),1)]),e("div",pt,[t[47]||(t[47]=e("span",{class:"text-gray-600"},"支付方式:",-1)),e("span",ct,n(B(u.value.payment_method)),1)]),e("div",gt,[t[48]||(t[48]=e("span",{class:"text-gray-600"},"交易号:",-1)),e("span",mt,n(u.value.transaction_id||"-"),1)]),e("div",xt,[t[49]||(t[49]=e("span",{class:"text-gray-600"},"状态:",-1)),e("span",{class:U([T(u.value.status),"px-2 py-1 rounded-full text-xs"])},n(V(u.value.status)),3)]),e("div",vt,[t[50]||(t[50]=e("span",{class:"text-gray-600"},"创建时间:",-1)),e("span",yt,n(P(u.value.created_at)),1)]),e("div",bt,[t[51]||(t[51]=e("span",{class:"text-gray-600"},"更新时间:",-1)),e("span",ft,n(P(u.value.updated_at)),1)])])])])):b("",!0)]),_:1}))}});export{wt as default};
